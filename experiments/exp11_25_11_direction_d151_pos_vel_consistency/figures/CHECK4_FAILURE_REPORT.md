# CHECK 4 FAILURE REPORT: Horizontal Acceleration Log

**Date:** Generated automatically  
**Experiment:** exp9_25_11_direction_d151_pos_vel_consistency  
**Checkpoint:** best.pt  
**Status:** ❌ **FAILED**

---

## Summary

Check 4 (Horizontal Acceleration Log) has **FAILED**. The model is producing significant horizontal acceleration (17.6 m/s²) when it should be near zero for near-vertical trajectories.

---

## Test Configuration

- **Procedure:** Compute horizontal acceleration from velocity: ax = dvx/dt, ay = dvy/dt
- **Expected:** For near-vertical rocket, |ax|, |ay| ≈ 0 (< 1 m/s²)
- **Actual:** max(|ax|) = 17.6 m/s², max(|ay|) = 0.37 m/s²

---

## Results

### Predicted Horizontal Acceleration
- **max(|ax|):** 17.6 m/s² ❌ (exceeds 1.0 m/s² threshold by 17.6x)
- **mean(|ax|):** 10.1 m/s² ❌
- **max(|ay|):** 0.37 m/s² ⚠️ (below threshold but non-zero)
- **mean(|ay|):** 0.07 m/s²

### True Horizontal Acceleration
- **max(|ax|):** 0.0 m/s² ✓
- **max(|ay|):** 0.0 m/s² ✓

---

## Root Cause Analysis

The model is predicting **significant horizontal acceleration** when the true trajectories have **zero horizontal acceleration**. This confirms that:

1. **G1 head is producing incorrect horizontal velocity** that leads to horizontal acceleration
2. **The velocity predictions are changing over time** (non-zero dvx/dt, dvy/dt)
3. **This is a fundamental model learning issue** - the model didn't learn to predict zero horizontal motion

### Connection to Previous Checks:

- **Check 3:** Showed translation wobble persists with true attitude → G1 head is the problem
- **Check 4:** Confirms G1 head produces horizontal acceleration → Forces/velocity are wrong

---

## Diagnostic Files Created

1. **Plot:** `check4_horizontal_acceleration_diagnostic.png`
   - Horizontal acceleration over time (ax, ay)
   - Comparison with true acceleration
   - Distribution histograms

2. **Data:** `check4_horizontal_acceleration_diagnostic.json`
   - All numerical results

3. **Script:** `scripts/diagnostic_check4_horizontal_acceleration.py`

---

## Code Locations to Investigate

### Primary Suspects:

1. **`src/models/direction_d_pinn.py`** - DirectionDPINN_D15 class
   - **Lines 524-560:** G1 head (translation prediction)
   - The head is directly outputting horizontal velocity that changes over time

2. **Training Configuration:**
   - Loss function weights for horizontal components
   - Training data characteristics

---

## Fix Suggestions

### Root Cause:
The G1 head is learning to predict horizontal velocity/acceleration when it shouldn't. This is a **training data or loss function issue**.

### Possible Solutions:

1. **Increase Loss Weight for Horizontal Components:**
   ```yaml
   component_weights:
     x: 5.0  # Increase from 1.0
     y: 5.0  # Increase from 1.0
     vx: 5.0  # Increase from 1.0
     vy: 5.0  # Increase from 1.0
   ```

2. **Add Explicit Horizontal Drift Penalty:**
   - Add loss term: `lambda_horizontal * mean(x² + y² + vx² + vy²)`

3. **Verify Training Data:**
   - Ensure training trajectories are truly vertical
   - Check if there's bias in the dataset

4. **Model Architecture:**
   - Consider adding explicit constraint for zero horizontal motion
   - Add regularization to penalize horizontal predictions

---

## Next Steps

Proceed to remaining diagnostic checks to gather more information before proposing final fix.

---

**Report Generated By:** Diagnostic Script (Check 4)  
**Script Location:** `scripts/diagnostic_check4_horizontal_acceleration.py`


